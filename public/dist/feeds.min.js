function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function getFeedWithNoUrl(e){$("#"+e+" .refresh_error").remove(),$("#"+e).append("<div class= 'feed_loader' align='center' style='vertical-align:middle;'> <i   class='fa fa-spinner fa-pulse'></i></div>"),$.ajax({type:"GET",url:base_url+"/get_feed_url",data:{feed_name:e},success:function(t){getFeed(e,t[0].feed_url)},error:function(){console.log("error fetching feed url!")}})}function addFeed(e,t){var r;if("load"===t){r=e.feed_name;var a=e.feed_url;$("#"+r+"_button").html("<i class='fa fa-spinner fa-pulse'></i> adding.."),$("#"+r+"_button").prop("disabled",!0),$("#feeds").append("<div class='news_feed_outer col-xs-12'><h3>"+r.replace(/_/g," ")+"<span><button  class='remove_button btn btn-xs btn-default pull-right' onclick='remove_feed(\""+r+"\")'><i class='fa fa-times'></i></button></span></h3><div id='"+r+"' class='feeds news_feed'></div></div>"),getFeed(r,a)}else r=e,$("#"+r+"_button").html("<i class='fa fa-spinner fa-pulse'></i> adding.."),$("#"+r+"_button").prop("disabled",!0),$("#feeds").prepend("<div class='news_feed_outer col-xs-12'><h3>"+r.replace(/_/g," ")+"<span><button  class='remove_button btn btn-xs btn-default pull-right' onclick='remove_feed(\""+r+"\")'><i class='fa fa-times'></i></button></span></h3><div id='"+r+"' class='feeds news_feed'></div></div>"),save_feed(r),getFeedWithNoUrl(r)}function getFeed(e,t){var r,a=t;switch(e){case"wikiquote_-_quote_of_the_day":r="//*[@id='mf-qotd']/div/div[2]/table/tbody/tr[1]/td/table/tbody/tr/td[3]/table/tbody";break;case"wikipedia_-_did_you_know":r="//*[@id='mp-dyk']/ul/li";break;case"wikipedia_-_on_this_day":r="//*[@id='mp-right']/tbody/tr[4]";break;default:r=""}if(0===$("#"+e).find(".feed_loader").length&&$("#"+e).append("<div class= 'feed_loader' align='center' style='vertical-align:middle;'> <i   class='fa fa-spinner fa-pulse'></i></div>"),""===r)$.ajax({url:"https://query.yahooapis.com/v1/public/yql",dataType:"json",data:{q:"select * from rss where url='"+a+"' limit 10",format:"json"},success:function(t){displayFeed(t,e),$("#"+e+"_button").html("added")},error:function(){add_refresh_message(e)}});else{var i='use "http://www.datatables.org/data/htmlstring.xml" as html.tostring;select * from html.tostring where url="'+a+'" and xpath="'+r+'"';$.ajax({url:"https://query.yahooapis.com/v1/public/yql",dataType:"json",data:{q:i,env:"store://RjdEzitN2Hceujh3tGHPj6",format:"json"},success:function(t){displayScrapedFeed(t,e),$("#"+e+"_button").html("added")},error:function(){add_refresh_message(e)}})}}function displayFeed(e,t){if(e.query.results){console.log("feed: ",e.query.results);var r,a,i,s,n,o,d,l,u,c,f,p,g,m,h,_,b,v=e.query.results.item,y=v.length,w=3;for(r=0;y>r;r++)a=Array.isArray(v[r].title)===!0?v[r].title[0]:v[r].title?v[r].title:"",i=Array.isArray(v[r].link)===!0&&v[r].link[0]&&v[r].link[0].href?v[r].link[0].href:v[r].link?v[r].link:"",a&&i?(s=Array.isArray(v[r].description)===!0?v[r].description[0]:v[r].description?v[r].description:"",c=v[r].encoded?v[r].encoded:"",n=v[r].thumbnail?Array.isArray(v[r].thumbnail)===!0?v[r].thumbnail[0]:v[r].thumbnail:"",o=n?n.url?n.url:n:"",""===o&&v[r].enclosure&&(o=v[r].enclosure.url?v[r].enclosure.url:""),""===o&&v[r].content&&(o=v[r].content.url?v[r].content.url:""),""===o&&v[r].imgURL&&(o=v[r].imgURL),""===o&&v[r].image&&(o=v[r].image.url?v[r].image.url:v[r].image),""===o&&v[r].postimage&&(o=v[r].postimage),""===o&&v[r].imageThumb&&(o=v[r].imageThumb),""===o&&v[r].group&&(o=v[r].group.content&&v[r].group.content.url?v[r].group.content.url:""),""===o&&v[r].encoded&&(d=c,l=document.createElement("div"),l.innerHTML=d,u=l.getElementsByTagName("img")[0],l.innerHTML="",u&&u.hasAttribute("src")?u.hasAttribute("height")&&u.hasAttribute("width")?(o=u.getAttribute("width")<50||u.getAttribute("height")<50?"":u.getAttribute("src"),u.setAttribute("src","")):(o=u.getAttribute("src"),u.setAttribute("src","")):o=""),""===o&&(d=s,l=document.createElement("div"),l.innerHTML=d,u=l.getElementsByTagName("img")[0],l.innerHTML="",u&&u.hasAttribute("src")?u.hasAttribute("height")&&u.hasAttribute("width")?(o=u.getAttribute("width")<50||u.getAttribute("height")<50?"":u.getAttribute("src"),u.setAttribute("src","")):(o=u.getAttribute("src"),u.setAttribute("src","")):o=""),f=/\.(gif|jpg|jpeg|tiff|png)/i,p=f.test(o),p===!1&&(o=""),o&&"http"!==o.substr(0,4)&&"//"!==o.substr(0,2)&&(o=""),i&&"http"!==i.substr(0,4)&&"//"!==o.substr(0,2)&&(i=""),"BBC_News"==t.substr(0,8)&&(o=v[r].thumbnail&&Array.isArray(v[r].thumbnail)?v[r].thumbnail.length>1?v[r].thumbnail[1].url:v[r].thumbnail[0].url:""),g=""!==o?"<img class='lazy' width='100' height='80'  align='left' data-original='"+o+"'></img>":"",m=v[r].pubDate?v[r].pubDate:"",h=convert_time(m),"Google_News"==t.substr(0,11)?(b=r>2?"collapsible":"",_="<div class='entry  entry-"+r+" "+b+"'>"+s+"<hr/></div>"):(s=s.replace(/<(?:.|\n)*?>/gm," "),b=r>w?"collapsible":"",_="<div class='yahoo_news_entry "+b+" '><h3><a href='"+i+"' target='blank'>"+g+"<b>"+a+"</b></a></h3><p>"+s+"</p><span class='time'>"+h+"</span><hr/></div>"),$("#"+t+" .feed_loader").remove(),$("#"+t).append(_),"Google_News"==t.substr(0,11)&&($("#"+t+" .entry-"+r+" div.lh font:first-child").append("<span class='time'>"+h+"</span>"),$("#"+t+" a").attr("target","blank"))):w+=1;add_view_more_button(t),"Google_News"==t.substr(0,11)&&($("div.lh ").siblings().remove(),$("div.lh .p").remove(),$("#"+t+" .entry table tr td:first-child font a font").remove(),$("#"+t+" div.lh br:last-child").remove())}else add_refresh_message(t)}function add_refresh_message(e){$("#"+e+" .feed_loader").remove(),$("#"+e).append("<div class='refresh_error'>please<button type='button' class='refresh_button btn btn-xs btn-link' onclick = 'getFeedWithNoUrl(\""+e+"\")'>refresh</button>or try again later!</div>"),console.log("error fetching "+e+" feed")}function show_more(e){$("#"+e+" .collapsible").show(300),$("#"+e+" .collapse_button").remove()}function add_view_more_button(e){$("#"+e).append("<button type='button' class='collapse_button btn btn-link pull-right' onclick = 'show_more(\""+e+"\")'>view more</button>"),$("#"+e+" .collapsible").hide(),$("#"+e+" img.lazy").lazyload({skip_invisible:!0})}function displayScrapedFeed(e,t){if(console.log("scraped feed: ",e),e)if("wikiquote_-_quote_of_the_day"==t){var r=e.query.results.result.replace(/<(?:.|\n)*?>/gm,""),a=[];a=r.split("~");var i="https://en.wikipedia.org/wiki/"+a[1].trim();$("#"+t+" .feed_loader").remove(),$("#"+t).append("<div class='entry container-fluid'><p><i class='fa fa-quote-left'></i> <i>"+a[0]+"<i> <i class='fa fa-quote-right'></i></p><span>~<a href='"+i+"' target='blank'>"+a[1]+"</a></span></div>")}else{var s=e.query.results.result;$("#"+t+" .feed_loader").remove(),$("#"+t).append("<div class='entry container-fluid'>"+s+"</div>"),"wikipedia_-_on_this_day"==t&&($("#mp-otd div").remove(),$("#mp-otd ul").eq(1).remove()),$("#"+t+" a").attr("href",function(e,t){return"https://en.wikipedia.org"+t}),$("#"+t+" a").attr("target","blank")}}function save_feed(e){$.ajax({url:base_url+"/add_feed",type:"POST",data:"feed="+e,success:function(t){console.log(e+" added successfully")},error:function(){console.log("error adding "+e+" feed")}})}function remove_feed(e){$("#"+e).parents(".news_feed_outer").remove(),$("#"+e+"_button").prop("disabled",!1),$("#"+e+"_button").html("add"),$.ajax({url:base_url+"/remove_feed",type:"POST",data:"feed="+e,success:function(t){console.log(e+" removed successfully")},error:function(){console.log("error removing "+e+" feed")}}),console.log(e+" deleted successfully");var t=[];$(".feeds").each(function(e,r){t[e]=$(".feeds").eq(e).attr("id")}),0===t.length&&save_feed("void_feed")}function convert_time(e){var t=new Date(e),r=new Date,a=t.toDateString(),i=t.toLocaleTimeString();e=a+" at "+i;var s,n,o=r.getTime(),d=t.getTime(),l=o-d,u=l/6e4,c=l/36e5,f=l/864e5,p=l/6048e5;return f>7?(p=parseInt(p),s=1==p?p+" week ago ":p+" weeks ago "):c>24?(f=parseInt(f),s=1==f?f+" day ago ":f+" days ago "):u>60?(c=parseInt(c),s=1==c?c+" hr ago ":c+" hrs ago "):(u=parseInt(u),s=1==u?u+" min ago ":u+" mins ago "),n=s}$(document).ready(function(){$.ajax({type:"GET",url:base_url+"/show_feeds",success:function(e){console.log("retrieved feeds Successfully",e),isEmpty(e)||e.forEach(function(e,t){"void_feed"!==e.feed_name&&addFeed(e,"load")})},error:function(){console.log("error fetching feeds!")}}),$("#add_feeds").on("click",function(){$("#add_feeds_modal").modal("show")}),$(".add_feed_button").on("click",function(){var e=$(this).attr("id");addFeed(e.slice(0,-7),"add")}),$("#add_feeds_modal").on("shown.bs.modal",function(){$("#add_feeds_modal img.lazy").lazyload({skip_invisible:!0,container:$("#add_feeds_modal")})})});var time;