function handleClientLoad(){gapi.client.setApiKey(apiKey),window.setTimeout(checkAuth,1)}function checkAuth(){gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!0},handleAuthResult)}function handleAuthResult(e){if(null===document.getElementById("mail_loader")&&$("#gmail_unread").append("<div id = 'mail_loader' align='center' style='vertical-align:middle;'> <i   class='fa fa-spinner fa-pulse'></i></div>"),e&&!e.error)$("#authorize-message").remove(),$("#gmail_footer").show(),makeApiCall();else{$("#mail_loader").remove(),$("#gmail_unread").append("<p id='authorize-message'>please log in to Gmail <button id='authorize-button' class='btn btn-xs btn-primary' >Log In</button></p>");var a=document.getElementById("authorize-button");a.onclick=handleAuthClick}}function handleAuthClick(e){return gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!1},handleAuthResult),!1}function makeApiCall(){gapi.client.load("gmail","v1",function(){{var e=gapi.client.gmail.users.messages.list({userId:"me",labelIds:"INBOX",maxResults:5});e.execute(function(e){console.log(e),$("#mail_loader").remove(),e.messages&&e.messages.forEach(function(e,a){{var l=gapi.client.gmail.users.messages.get({userId:"me",id:e.id,format:"metadata",metadataHeaders:["From","Subject","Date"]});l.execute(function(e){var a=e.id,l="From"==e.payload.headers[0].name?e.payload.headers[0].value:"From"==e.payload.headers[1].name?e.payload.headers[1].value:e.payload.headers[2].value,t="Subject"==e.payload.headers[0].name?e.payload.headers[0].value:"Subject"==e.payload.headers[1].name?e.payload.headers[1].value:e.payload.headers[2].value,i="Date"==e.payload.headers[0].name?e.payload.headers[0].value:"Date"==e.payload.headers[1].name?e.payload.headers[1].value:e.payload.headers[2].value,o=(e.snippet?e.snippet:"[empty]",new Date(i)),n=o.toLocaleTimeString(),s=n.split(" "),d=7==s[0].length?4:5,r=s[0].slice(0,d)+" "+s[1],c=o.toDateString(),p=c.slice(4),u=new Date;u.toDateString()===o.toDateString()?p="Today":r="";var m,h=""===r?p:p+", "+r,g=e.labelIds;g.forEach(function(e,a){"UNREAD"==e&&(l+="<i class='fa fa-envelope' title='new mail'></i>",m=0)}),0===m?$("#gmail_unread").append("<a href = 'https://mail.google.com/mail/u/0/#inbox/"+a+"' target='blank'><div class='mail'><b>"+l+"</b><span style = 'float:right; color:black;'>"+h+"</span><br><div style='color:black;'>"+t+"</div></div></a><hr>"):$("#gmail_read").append("<div class='mail'><b>"+l+"</b><span style = 'float:right; color:black;'>"+h+"</span><br><div style='color:black;'>"+t+"</div></div><hr>")})}})})}})}var clientId="http://localhost:8080"==window.location.origin?"51183448959-uqfe8esqtcs5f4obkq40glhhf19ap57c.apps.googleusercontent.com":"51183448959-mr3hlk2qt63t32a81ivl7h77d4qc4aip.apps.googleusercontent.com",apiKey="AIzaSyBKaRnMANldQSuwL0ckiPKb-JRgsA_Yyoo",scopes="https://www.googleapis.com/auth/gmail.readonly";$.getScript("https://apis.google.com/js/client.js?onload=handleClientLoad");